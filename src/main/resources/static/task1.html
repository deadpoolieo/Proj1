<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>示例</title>
  <script type="text/javascript" src="Jquery.js"></script>

  <style>

    body {
      margin: 0px;
      padding: 0px;
      background-image: url('background.webp');
    }
    .header{
      font-size: 22px;
      text-align: center;
      margin:20px auto;
    }
    .question {
      display: inline-block;
      width: 300px;
      text-align: right;
    }
    .answer {
      display: inline;
      width: 300px;
      position: relative;
    }
    .biaoqian {
      display: inline-block;
      width: 300px;
      text-align: right;
    }
    select {
      display: inline-block;
      width: 500px;
      height: 30px;
    }
    p {
      font-size: small;
      display: block;
      text-align: center;
      padding: 20px;
    }
    .tishi{
      position: absolute;
      width: 200px;
    }
    .tijiao {
      text-align: center;
    }
    .button{
      width: 100px;
      height: 30px;
      line-height: 15px;
      background: #2e82ff;
      color: #ffffff;
      font-size: 13px;
      border-radius: 13px;
      text-align: center;
      border: none;
    }
    span{
      color: red;
      font-size: 15px;
    }

  </style>
</head>
<body>
<div class="header">
  <h2>基本情報</h2>
</div>

<!--フォーム内容-->
<form class="form" id="form-save">

  <!--姓(漢字)-->
  <label class="question" id="xingLable">姓(漢字) </label>
  <div class="answer">
    <input type="text" name="xing" id="xing" placeholder="漢字で入力してください"  >
    <span class="tishi" id="tsxing"></span>
  </div>

  <!--名(漢字)-->
  <label class="question">名(漢字)</label>
  <div class="answer">
    <input type="text" name="ming" id="ming" placeholder="漢字で入力してください"  >
    <span class="tishi" id="tsming"></span>
  </div>

  <br><br>

  <!--セイ-->
  <label class="question">セイ</label>
  <div class="answer">
    <input type="text" name="sei" id="sei" placeholder="カタカナで入力してください" >
    <span class="tishi" id="tssei"></span>
  </div>

  <!--メイ-->
  <label class="question">メイ</label>
  <div class="answer">
    <input type="text" name="mei" id="mei" placeholder="カタカナで入力してください" >
    <span class="tishi" id="tsmei"></span>
  </div>

  <br><br>

  <!--姓(ローマ字)-->
  <label class="question">姓(ローマ字)</label>
  <div class="answer">
    <input type="text" name="romasei" id="romasei" placeholder="ローマ字で入力してください" >
    <span class="tishi" id="tsromasei"></span>
  </div>

  <!--名(ローマ字)-->
  <label class="question">名(ローマ字)</label>
  <div class="answer">
    <input type="text" name="romamei" id="romamei" placeholder="ローマ字で入力してください" >
    <span class="tishi" id="tsromamei"></span>
  </div>

  <br><br>
  <!--国籍-->
  <label class="biaoqian">国籍</label>
  <select name="country" id="country" >
    <option value="">オプションを選択してください。</option>
    <option value="中国">中国</option>
    <option value="日本">日本</option>
    <option value="韓国">韓国</option>
    <option value="スペイン">スペイン</option>
  </select>

  <br>

  <p>母語が日本語ではない方は日本語能力を証明する書類を提出していただく必要があります。詳細は募集要項をご確認ください</p>

  <!--性别-->
  <label class="biaoqian"> 性别：</label>
  <label>
    <input type="radio" name="sex" id="sex1" value="男">男
  </label>
  <label>
    <input type="radio" name="sex" id="sex2" value="女">女
  </label>
  <label>
    <input type="radio" name="sex" id="sex3" value="Decline to State(声明拒否)">Decline to State(声明拒否)
  </label>

  <br><br>

  <!--生日年月-->
  <label class="biaoqian">生日年月</label>
  <div class="answer">
    <input type="date" class="answer" name="birth" id="birth">
  </div>

  <br><br>

  <!--電話番号-->
  <label class="biaoqian">電話番号</label>
  <div class="answer">
    <input type="text" class="answer" id="tel" name="tel"  >
    <span id="tstel"></span>
  </div>

  <br><br>

  <!--携帯電話-->
  <label class="biaoqian">携帯電話</label>
  <div class="answer">
    <input type="text" class="answer" id="phone" name="phone" >
    <span id="tsphone"></span>
  </div>

  <br><br>

  <!--職業-->
  <label class="biaoqian">職業</label>
  <select id="job" name="job" >
    <option value="">オブションを選択</option>
    <option value="01自営業" >01 自営業</option>
    <option value="02公務員" >02 公務員</option>
    <option value="03会社役員" >03 会社役員</option>
    <option value="04その他" >04 その他</option>
    <option value="05無職" >05 無職</option>
  </select>

  <br><br>

  <!--勤務先(任意)-->
  <label class="biaoqian"> 勤務先(任意) </label>
  <div class="answer">
    <input type="text" class="answer" id="address" name="address"  >
    <span id="tsaddress"></span>
  </div>

  <br><br>

  <!--ボタン-->
  <div class="tijiao">
    <button type="button" class="button" id="save" >基本情報保存</button>&nbsp;&nbsp;
    <button type="button" class="button" id="next" >次へ</button>
  </div>
</form>

<script>

   //获取表单输入框
   //フォーム入力ボックスを取得する

    let xingInput = document.getElementById('xing');
    let mingInput = document.getElementById('ming');
    let seiInput = document.getElementById('sei');
    let meiInput = document.getElementById('mei');
    let romaseiInput = document.getElementById('romasei');
    let romameiInput = document.getElementById('romamei');
    let countryInput = document.getElementById('country');
    let birthInput = document.getElementById('birth');
    let telInput = document.getElementById('tel');
    let phoneInput = document.getElementById('phone');
    let jobInput = document.getElementById('job');
    let addressInput = document.getElementById('address');
    let saveButton = document.getElementById('save');
    let nextButton = document.getElementById('next');


    //保存按钮添加单击事件
   //保存ボタンのクリックイベントを追加する
    saveButton.addEventListener('click', () => {

      // 获取表单输入框的值
      //フォーム入力ボックスの値を取得する
      let xing = xingInput.value.trim();
      let ming = mingInput.value.trim();
      let sei = seiInput.value.trim();
      let mei = meiInput.value.trim();
      let romasei = romaseiInput.value.trim();
      let romamei = romameiInput.value.trim();
      let country = countryInput.options[countryInput.selectedIndex].value.trim();
      let gender = document.getElementsByName("sex");
      let sexValue='';
      for (let i = 0; i < gender.length; i++) {
        if (gender[i].checked === true) {
          sexValue = gender[i].value;
        }
      }
      let sex = sexValue.trim();
      let birth = birthInput.value.trim();
      let tel = telInput.value.trim();
      let phone = phoneInput.value.trim();
      let job = jobInput.options[jobInput.selectedIndex].value.trim();
      let address = addressInput.value.trim();


      let check1 = /^[\u4E00-\u9FA5]+$/;
      if (check1.test(xingInput.value)===false) {
        alert('姓を漢字で入力してください')
         return;
      }
      if (xingInput.value.length>40) {
        alert('入力した姓が長すぎます。40字内で再入力してください。')
        return;
      }
      if (check1.test(mingInput.value)===false) {
        alert('名を漢字で入力してください')
        return;
      }
      if (mingInput.value.length>40) {
        alert('入力した名が長すぎます。40字内で再入力してください。')
        return;
      }
      let check2 = /^[ｧ-ﾝﾞﾟ]+$/;
      if (check2.test(seiInput.value)===false) {
        alert('セイをカタカナでで入力してください')
        return;
      }
      if (seiInput.value.length>40) {
        alert('入力したセイが長すぎます。40字内で再入力してください。')
        return;
      }
      if (check2.test(meiInput.value)===false) {
        alert('メイをカタカナでで入力してください')
        return;
      }
      if (meiInput.value.length>40) {
        alert('入力したメイが長すぎます。40字内で再入力してください。')
        return;
      }
      let check3 = /^[a-zA-Z]+$/g;
      if (check3.test(romaseiInput.value)===false) {
        alert('姓をローマ字で入力してください')
        return;
      }
      if (romaseiInput.value.length>40) {
        alert('入力した姓が長すぎます。40字内で再入力してください。')
        return;
      }
      let check9 = /^[a-zA-Z]*$/g;
      if (check9.test(romameiInput.value)===false) {
        alert('名をローマ字で入力してください')
        return;
      }
      if (romameiInput.value.length>40) {
        alert('入力した名が長すぎます。40字内で再入力してください。')
        return;
      }
      let check4 = /^\d{11}$/;
      if (check4.test(telInput.value)===false) {
        alert('電話番号を11個数字で入力してください。')
        return;
      }
      if (check4.test(phoneInput.value)===false) {
        alert('携帯電話を11個数字で入力してください。')
        return;
      }
      if (addressInput.value.length>40) {
        alert('入力した文字が長すぎます。40字内で再入力してください。')
        return;
      }

      //将取得的数据保存到数据库
      //Web経由で取得したデーターをデータベースに保存する

      fetch('/users/add', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        //将数据转换成json形式传送
        //データをjson形式で伝送
        body: JSON.stringify({xing, ming, sei, mei, romasei, romamei, country, sex, birth, tel, phone, job, address})
      })
              // 所有信息都正确的话就传输到数据库
              // すべての情報が正しい場合は、データベースに転送する
              .then(response => {
                if (response.ok) {
                  alert('保存成功');


                } else {
                  return response.text().then(text => {
                    throw new Error(text)
                  });
                }
              })
              // 如果存在有问题的输入, 就alert提示错误
              // 入力に異常がある場合、エラーで警告する
              .catch(error => {
                alert(error.message);
              });
    });


   //下一页按钮添加单击事件
   //次へボタンのクリックイベントを追加する
    nextButton.addEventListener('click', () => {

      let xing = xingInput.value.trim();
      let ming = mingInput.value.trim();
      let sei = seiInput.value.trim();
      let mei = meiInput.value.trim();
      let romasei = romaseiInput.value.trim();
      let romamei = romameiInput.value.trim();
      let country = countryInput.options[countryInput.selectedIndex].value.trim();
      let gender = document.getElementsByName("sex");
      let sexValue='';
      for (let i = 0; i < gender.length; i++) {
        if (gender[i].checked === true) {
          sexValue = gender[i].value;
        }
      }
      let sex = sexValue.trim();
      let birth = birthInput.value.trim();
      let tel = telInput.value.trim();
      let phone = phoneInput.value.trim();
      let job = jobInput.options[jobInput.selectedIndex].value.trim();
      let address = addressInput.value.trim();

      let check1 = /^[\u4E00-\u9FA5]+$/;
      if (check1.test(xingInput.value)===false) {
        alert('姓を漢字で入力してください')
        return;
      }
      if (xingInput.value.length>40) {
        alert('入力した姓が長すぎます。40字内で再入力してください。')
        return;
      }
      if (check1.test(mingInput.value)===false) {
        alert('名を漢字で入力してください')
        return;
      }
      if (mingInput.value.length>40) {
        alert('入力した名が長すぎます。40字内で再入力してください。')
        return;
      }
      let check2 = /^[ｧ-ﾝﾞﾟ]+$/;
      if (check2.test(seiInput.value)===false) {
        alert('セイをカタカナでで入力してください')
        return;
      }
      if (seiInput.value.length>40) {
        alert('入力したセイが長すぎます。40字内で再入力してください。')
        return;
      }
      if (check2.test(meiInput.value)===false) {
        alert('メイをカタカナでで入力してください')
        return;
      }
      if (meiInput.value.length>40) {
        alert('入力したメイが長すぎます。40字内で再入力してください。')
        return;
      }
      let check3 = /^[a-zA-Z]+$/g;
      if (check3.test(romaseiInput.value)===false) {
        alert('姓をローマ字で入力してください')
        return;
      }
      if (romaseiInput.value.length>40) {
        alert('入力した姓が長すぎます。40字内で再入力してください。')
        return;
      }

      let check9 = /^[a-zA-Z]*$/g;
      if (check9.test(romameiInput.value)===false) {
        alert('名をローマ字で入力してください')
        return;
      }

        if (romameiInput.value.length > 40) {
          alert('入力した名が長すぎます。40字内で再入力してください。')
          return;
        }
        let check4 = /^\d{11}$/;
        if (check4.test(telInput.value) === false) {
          alert('電話番号を11個数字で入力してください。')
          return;
        }
        if (check4.test(phoneInput.value) === false) {
          alert('携帯電話を11個数字で入力してください。')
          return;
        }
        if (addressInput.value.length > 40) {
          alert('入力した文字が長すぎます。40字内で再入力してください。')
          return;
        }

      //将取得的数据保存到数据库
      //Web経由で取得したデーターをデータベースに保存する
      fetch('/users/add', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({xing, ming, sei, mei, romasei, romamei, country, sex, birth, tel, phone, job, address})
      })
              // 所有信息都正确的话就传输到数据库
              // すべての情報が正しい場合は、データベースに転送する
              .then(response => {
                if (response.ok) {
                  alert('保存成功');　
                  //保存成功后跳转到新的页面
                  //保存成功後新しいページへ飛ぶ
                  window.location.href="task2.html"

                } else {
                  return response.text().then(text => {
                    throw new Error(text)
                  });
                }
              })
              // 如果存在有问题的输入, 就alert提示错误
              // 入力に異常がある場合、エラーで警告する
              .catch(error => {
                alert( error.message);
              });
    });


   // 英数字的全角转换为半角
   // 英数字の全角-半角変換
    function hankaku2Zenkaku(str) {
      return str.replace(/[Ａ-Ｚａ-ｚ０-９]/g, function (s) {
        return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
      });
    };

   // カタカナ的全角转换为半角
   // カタカナの全角から半角への変換
    function zenkana2Hankana(str) {
      let kanaMap = {
        "ガ": "ｶﾞ", "ギ": "ｷﾞ", "グ": "ｸﾞ", "ゲ": "ｹﾞ", "ゴ": "ｺﾞ",
        "ザ": "ｻﾞ", "ジ": "ｼﾞ", "ズ": "ｽﾞ", "ゼ": "ｾﾞ", "ゾ": "ｿﾞ",
        "ダ": "ﾀﾞ", "ヂ": "ﾁﾞ", "ヅ": "ﾂﾞ", "デ": "ﾃﾞ", "ド": "ﾄﾞ",
        "バ": "ﾊﾞ", "ビ": "ﾋﾞ", "ブ": "ﾌﾞ", "ベ": "ﾍﾞ", "ボ": "ﾎﾞ",
        "パ": "ﾊﾟ", "ピ": "ﾋﾟ", "プ": "ﾌﾟ", "ペ": "ﾍﾟ", "ポ": "ﾎﾟ",
        "ヴ": "ｳﾞ", "ヷ": "ﾜﾞ", "ヺ": "ｦﾞ",
        "ア": "ｱ", "イ": "ｲ", "ウ": "ｳ", "エ": "ｴ", "オ": "ｵ",
        "カ": "ｶ", "キ": "ｷ", "ク": "ｸ", "ケ": "ｹ", "コ": "ｺ",
        "サ": "ｻ", "シ": "ｼ", "ス": "ｽ", "セ": "ｾ", "ソ": "ｿ",
        "タ": "ﾀ", "チ": "ﾁ", "ツ": "ﾂ", "テ": "ﾃ", "ト": "ﾄ",
        "ナ": "ﾅ", "ニ": "ﾆ", "ヌ": "ﾇ", "ネ": "ﾈ", "ノ": "ﾉ",
        "ハ": "ﾊ", "ヒ": "ﾋ", "フ": "ﾌ", "ヘ": "ﾍ", "ホ": "ﾎ",
        "マ": "ﾏ", "ミ": "ﾐ", "ム": "ﾑ", "メ": "ﾒ", "モ": "ﾓ",
        "ヤ": "ﾔ", "ユ": "ﾕ", "ヨ": "ﾖ",
        "ラ": "ﾗ", "リ": "ﾘ", "ル": "ﾙ", "レ": "ﾚ", "ロ": "ﾛ",
        "ワ": "ﾜ", "ヲ": "ｦ", "ン": "ﾝ",
        "ァ": "ｧ", "ィ": "ｨ", "ゥ": "ｩ", "ェ": "ｪ", "ォ": "ｫ",
        "ッ": "ｯ", "ャ": "ｬ", "ュ": "ｭ", "ョ": "ｮ",
        "。": "｡", "、": "､", "ー": "ｰ", "「": "｢", "」": "｣", "・": "･"
      }
      let reg = new RegExp('(' + Object.keys(kanaMap).join('|') + ')', 'g');
      return str
              .replace(reg, function (match) {
                return kanaMap[match];
              })
              .replace(/゛/g, 'ﾞ')
              .replace(/゜/g, 'ﾟ');
    };

   // 将姓的カナ全角转换为半角
   // 姓のカナ全角を半角に変換する
    seiInput.oninput = function () {
      seiInput.value=zenkana2Hankana(seiInput.value)
    };
   // 将名的カナ全角转换为半角
   // 名のカナ全角を半角に変換する
    meiInput.oninput = function () {
      meiInput.value=zenkana2Hankana(meiInput.value)
    };
   // 将罗马姓的英文全角转换为半角
   // ローマ姓の英語の全角から半角への変換
   romaseiInput.oninput = function () {
     romaseiInput.value=hankaku2Zenkaku(romaseiInput.value)
   };
   // 将罗马名的英文全角转换为半角
   // ローマ名の英語の全角から半角への変換
   romameiInput.oninput = function () {
     romameiInput.value=hankaku2Zenkaku(romameiInput.value)
   };
   // 将手机的英文全角转换为半角
   // 携帯電話の数字の全角から半角への変換
   phoneInput.oninput = function () {
     phoneInput.value=hankaku2Zenkaku(phoneInput.value)
   };
   // 将电话的英文全角转换为半角
   // 電話の数字の全角から半角への変換
   telInput.oninput = function () {
     telInput.value=hankaku2Zenkaku(telInput.value)
   };

    //各入力情報をチェックして、それに応じてエラーメッセージの表示/非表示を切り替える
    //检查每个输入框的内容，根据正误切换提示信息。
    xingInput.onblur = function () {
      let tsxing = document.getElementById('tsxing');
      let check1 = /^[\u4E00-\u9FA5]+$/;

      if (check1.test(xingInput.value)===false) {
        tsxing.innerHTML = '姓を漢字で入力してください';
      } else if (xingInput.value.length>40) {
        tsxing.innerHTML = '入力した姓が長すぎます。40字内で再入力してください。';
      }
      else {
        tsxing.innerHTML = '';
      }
    };

    mingInput.onblur = function () {
      let tsming = document.getElementById('tsming');
      let check1 = /^[\u4E00-\u9FA5]+$/;
      if (check1.test(mingInput.value)===false) {
        tsming.innerHTML = '名を漢字で入力してください';
      } else if (mingInput.value.length>40) {
        tsming.innerHTML = '入力した名が長すぎます。40字内で再入力してください。';
      }
      else {
        tsming.innerHTML = '';
      }
    };

    seiInput.onblur = function () {
      let tssei = document.getElementById('tssei');
      let check2 = /^[ｧ-ﾝﾞﾟ]+$/;
      if (check2.test(seiInput.value)===false) {
        tssei.innerHTML = 'セイをカタカナでで入力してください';
      } else if (seiInput.value.length>40) {
        tssei.innerHTML = '入力したセイが長すぎます。40字内で再入力してください。';
      }
      else {
        tssei.innerHTML = '';
      }
    };

    meiInput.onblur = function () {
      let tsmei = document.getElementById('tsmei');
      let check2 =/^[ｧ-ﾝﾞﾟ]+$/;
      if (check2.test(meiInput.value)===false) {
        tsmei.innerHTML = 'メイをカタカナでで入力してください';
      } else if (meiInput.value.length>40) {
        tsmei.innerHTML = '入力したメイが長すぎます。40字内で再入力してください。';
      }
      else {
        tsmei.innerHTML = '';
      }
    };

    romaseiInput.onblur = function () {
      let tsromasei = document.getElementById('tsromasei');
      let check3 = /^[a-zA-Z]+$/g;
      if (check3.test(romaseiInput.value)===false) {
        tsromasei.innerHTML = '姓をローマ字で入力してください';
      } else if (romaseiInput.value.length>40) {
        tsromasei.innerHTML = '入力した姓が長すぎます。40字内で再入力してください。';
      }
      else {
        tsromasei.innerHTML = '';
     }
   };
    romameiInput.onblur = function () {
     let tsromamei = document.getElementById('tsromamei');
     let check3 = /^[a-zA-Z]+$/g;
     if (check3.test(romameiInput.value)===false) {
       tsromamei.innerHTML = '名をローマ字で入力してください';
     } else if (romameiInput.value.length>40) {
       tsromamei.innerHTML = '入力した名が長すぎます。40字内で再入力してください。';
     }
     else {
       tsromamei.innerHTML = '';
     }
   };

    telInput.onblur = function () {
     let tstel = document.getElementById('tstel');
     let check4 = /^\d{11}$/;
     if (check4.test(telInput.value)===false) {
       tstel.innerHTML = '電話番号を11個数字で入力してください。';
     }
     else {
       tstel.innerHTML = '';
     }
   };

    phoneInput.onblur = function () {
      let telSave = telInput.value;
      localStorage.setItem("tel", telSave);
     let tsphone = document.getElementById('tsphone');
     let check4 = /^\d{11}$/;
     if (check4.test(phoneInput.value)===false) {
       tsphone.innerHTML = '携帯電話を11個数字で入力してください';
     }
     else {
       tsphone.innerHTML = '';
     }

   };

    //选择05无职，工作地点栏变灰，无法填信息。
   //05無職を選択すると、勤務先の名称欄入力できない（灰色になって選択不可）
     jobInput.onchange=function () {
       if (jobInput.options[jobInput.selectedIndex].value==="05無職"){
              addressInput.disabled=true;
           }else{
              addressInput.disabled=false;
           }
          };


   addressInput.onblur = function () {
       let addressSave = addressInput.value;
       localStorage.setItem("address", addressSave);
     let tsaddress = document.getElementById('tsaddress');
     if (addressInput.value.length>40) {
       tsaddress.innerHTML = '入力した文字が長すぎます。40字内で再入力してください。';
     }else {
       tsaddress.innerHTML = '';
     }
   };

</script>
</body>
</html>
